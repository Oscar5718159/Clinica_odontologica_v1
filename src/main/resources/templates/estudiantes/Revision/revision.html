<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historia Clínica Odontológica U.A.P.</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        html, body {
            height: 100%;
            background-color: #f0f8ff;
            overflow-x: hidden;
        }
        
        .container {
            width: 100%;
            min-height: 100vh;
            background-color: white;
            padding: 20px;
            border: 1px solid #ddd;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }
        
        .header-image {
            width: 100%;
            height: 200px;
            background: url('../../../static/img/encabezado.png') center/cover no-repeat;
            margin-bottom: 20px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .header-content {
            position: relative;
            z-index: 2;
            text-align: center;
            color: white;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #2c5aa0;
            padding-bottom: 15px;
        }
        
        .header h1 {
            font-size: 28px;
            color: #2c5aa0;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 14px;
        }
        
        /* Estilos mejorados para la búsqueda */
        .search-section {
            margin-bottom: 20px;
            padding: 20px;
            background-color: #f9fbff;
            border-radius: 6px;
            border-left: 4px solid #2c5aa0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .search-section h1 {
            font-size: 22px;
            color: #2c5aa0;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .search-form {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: flex-end;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #444;
            font-size: 14px;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccd9ff;
            border-radius: 4px;
            font-size: 14px;
            transition: border 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: #2c5aa0;
            outline: none;
            box-shadow: 0 0 0 2px rgba(44, 90, 160, 0.2);
        }
        
        /* BOTÓN DE BUSCAR - MANTENIENDO EL ESTILO ORIGINAL */
        .search-btn {
            background-color: #2c5aa0;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
            height: 40px;
        }
        
        .search-btn:hover {
            background-color: #1e3d6f;
        }
        
        .search-btn:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        
        .search-results {
            margin-top: 20px;
            border: 1px solid #ccd9ff;
            border-radius: 4px;
            overflow: hidden;
            display: none;
        }
        
        .results-header {
            background-color: #e6eeff;
            padding: 10px 15px;
            font-weight: bold;
            color: #2c5aa0;
        }
        
        .results-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .result-item {
            padding: 10px 15px;
            border-bottom: 1px solid #e0e7ff;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .result-item:hover {
            background-color: #f0f5ff;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .no-results {
            padding: 15px;
            text-align: center;
            color: #666;
        }
        
        .search-info {
            margin-top: 10px;
            font-size: 12px;
            color: #666;
            text-align: center;
        }
        
        .loading {
            text-align: center;
            padding: 10px;
            color: #2c5aa0;
        }
        
        /* Estilos para el resto del formulario */
        .form-section {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f9fbff;
            border-radius: 6px;
            border-left: 4px solid #2c5aa0;
        }
        
        .section-title {
            font-size: 18px;
            color: #2c5aa0;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e7ff;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 15px;
            gap: 15px;
        }
        
        .form-group.full-width {
            flex: 0 0 100%;
        }
        
        .form-divider {
            border-top: 1px dashed #a8c0ff;
            margin: 20px 0;
            padding-top: 20px;
        }
        
        .checkbox-group {
            display: flex;
            gap: 20px;
            margin-top: 5px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .checkbox-item input[type="radio"], .checkbox-item input[type="checkbox"] {
            width: auto;
        }
        
        .diseases-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .diseases-table th, .diseases-table td {
            border: 1px solid #ccd9ff;
            padding: 10px;
            text-align: center;
        }
        
        .diseases-table th {
            background-color: #e6eeff;
            color: #2c5aa0;
            font-weight: 600;
        }
        
        .diseases-table td {
            background-color: white;
        }
        
        .diseases-table input[type="checkbox"] {
            width: auto;
        }
        
        .odontograma-section {
            margin: 20px 0;
            padding: 20px;
            background-color: #f9fbff;
            border-radius: 6px;
            border: 1px solid #ccd9ff;
        }
        
        .odontograma-section h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #2c5aa0;
        }
        
        .odontograma-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            overflow-x: auto;
        }
        
        .dental-chart {
            display: grid;
            grid-template-columns: repeat(16, 1fr);
            gap: 2px;
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .tooth-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .tooth {
            width: 35px;
            height: 50px;
            background-color: #fff;
            border: 1px solid #aaa;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            position: relative;
        }
        
        .tooth:hover {
            background-color: #f0f5ff;
        }
        
        .tooth.selected {
            background-color: #ffcccb;
            border-color: #ff6b6b;
        }
        
        .tooth-number {
            font-size: 12px;
            color: #555;
            margin-bottom: 5px;
        }
        
        .jaw-label {
            text-align: center;
            font-weight: bold;
            margin: 10px 0;
            color: #2c5aa0;
            grid-column: 1 / -1;
        }
        
        .current-selection {
            text-align: center;
            margin: 15px 0;
            padding: 10px;
            background-color: #e6eeff;
            border-radius: 4px;
            font-weight: 500;
        }
        
        .area-selector {
            display: none;
            flex-direction: column;
            align-items: center;
            margin: 15px 0;
        }
        
        .area-selector-title {
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c5aa0;
        }
        
        .area-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .area-btn {
            padding: 8px 15px;
            border: 1px solid #2c5aa0;
            background-color: white;
            color: #2c5aa0;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .area-btn:hover, .area-btn.active {
            background-color: #2c5aa0;
            color: white;
        }
        
        .diagnostic-criteria {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        
        .criteria-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .criteria-item:hover {
            background-color: #f0f5ff;
        }
        
        .criteria-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            border: 1px solid #999;
        }
        
        .sano-color { background-color: #ffffff; }
        .cariado-color { background-color: #f8d7da; }
        .obturado-color { background-color: #fff3cd; }
        .perdido-caries-color { background-color: #dc3545; }
        .perdido-otra-color { background-color: #6c757d; }
        .soporte-color { background-color: #17a2b8; }
        .no-erupcionado-color { background-color: #e9ecef; }
        .traumatismo-color { background-color: #fd7e14; }
        .no-registrado-color { background-color: #6f42c1; }
        .extraccion-color { background-color: #20c997; }
        .traumatismo-fractura-color { background-color: #ffc107; }
        
        .cpod-section {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .cpod-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .cpod-item span {
            font-weight: bold;
            color: #2c5aa0;
        }
        
        .cpod-item input {
            width: 50px;
            text-align: center;
        }
        
        .tooth-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        .btn-primary {
            background-color: #2c5aa0;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1e3d6f;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #545b62;
        }
        
        .footer {
            margin-top: 20px;
            text-align: center;
            font-size: 12px;
            color: #777;
            padding-top: 15px;
            border-top: 1px solid #e0e7ff;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            font-size: 12px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }
        
        .selected-color {
            background-color: #ffcccb;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header-image {
                height: 180px;
            }
            
            .form-group {
                flex: 0 0 100%;
            }
            
            .dental-chart {
                grid-template-columns: repeat(8, 1fr);
            }
            
            .tooth {
                width: 30px;
                height: 40px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .header-image {
                height: 150px;
            }
            
            .header h1 {
                font-size: 22px;
            }
            
            .dental-chart {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .tooth {
                width: 25px;
                height: 35px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Imagen de encabezado con tu imagen -->
        <div class="header-image">
            <div class="header-content">
                <!-- El contenido se mostrará sobre la imagen -->
            </div>
        </div>
        
        <div class="header">
            <h4>Número de Expediente Clínico: <span id="headerExpediente">-</span></h4>
            <h4>N.º de historia clinica: <span id="headerHistoria">-</span></h4>
            <h4>CI: <span id="headerCI">-</span></h4>
            <h1>HISTORIA CLÍNICA ODONTOLÓGICA U.A.P.</h1>
            <p>Universidad Amazonica de Pando</p>
        </div>
        
        <!-- SECCIÓN DE BÚSQUEDA MEJORADA -->
        <div class="search-section">
            <h1>BUSCAR PACIENTE</h1>
            <div class="search-form">
                <div class="form-group">
                    <label>NOMBRE Y APELLIDOS</label>
                    <input type="text" id="nombreBusqueda" placeholder="Ingrese nombre completo">
                </div>
                <div class="form-group">
                    <label>C.I.</label>
                    <input type="text" id="ciBusqueda" placeholder="Ingrese CI">
                </div>
                <div class="form-group">
                    <button type="button" class="search-btn" id="btnBuscar">BUSCAR</button>
                </div>
            </div>
            
            <div class="search-info">
                Puede buscar por nombre completo o por CI. Al menos uno de los campos debe estar completo.
            </div>
            
            <!-- Resultados de búsqueda -->
            <div class="search-results" id="resultadosBusqueda">
                <div class="results-header">Resultados de la búsqueda</div>
                <div class="results-list" id="listaResultados">
                    <!-- Los resultados se cargarán aquí dinámicamente -->
                </div>
            </div>
        </div>
        
        <!-- Formulario de datos del paciente -->
        <div class="form-section">
            <h1>SECCION 2</h1>
            <h2 class="section-title">DATOS DE IDENTIFICACIÓN</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>N.º de Historia Clínica</label>
                    <input type="text" id="numHistoriaClinica" readonly>
                </div>
                <div class="form-group">
                    <label>C.I.</label>
                    <input type="text" id="ciPaciente" readonly>
                </div>
                <div class="form-group">
                    <label>N.º de Expediente Clínico</label>
                    <input type="text" id="numExpediente" readonly>
                </div>
            </div>

            
            <div class="form-row">
                <div class="form-group">
                    <label>Persona que brinda la información</label>
                    <input type="text" id="personaInformacion">
                </div>
                <div class="form-group">
                    <label>Edad</label>
                    <input type="text" id="edadPaciente" readonly>
                </div>
                <div class="form-group">
                    <label>Sexo</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="radio" id="masculino" name="sexo" value="M">
                            <label for="masculino">M</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="radio" id="femenino" name="sexo" value="F">
                            <label for="femenino">F</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Sección de datos personales -->
        <div class="form-section">
            <h2 class="section-title">DATOS PERSONALES</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>Apellido Paterno</label>
                    <input type="text" id="apellidoPaterno" readonly>
                </div>
                <div class="form-group">
                    <label>Apellido Materno</label>
                    <input type="text" id="apellidoMaterno" readonly>
                </div>
                <div class="form-group">
                    <label>Nombres</label>
                    <input type="text" id="nombres" readonly>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Lugar y Fecha de Nacimiento</label>
                    <input type="text" id="lugarNacimiento" readonly>
                </div>
                <div class="form-group">
                    <label>Ocupación</label>
                    <input type="text" id="ocupacion" readonly>
                </div>
                <div class="form-group">
                    <label>Estado Civil</label>
                    <input type="text" id="estadoCivil" readonly>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group" style="flex: 2;">
                    <label>Dirección</label>
                    <input type="text" id="direccion" readonly>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Teléfono o Celular</label>
                    <input type="text" id="telefono" readonly>
                </div>
                <div class="form-group">
                    <label>Grado de Instrucción</label>
                    <input type="text" id="gradoInstruccion" readonly>
                </div>
            </div>
        </div>
        
        <!-- Resto de las secciones del formulario (se mantienen igual) -->
        <div class="form-section">
            <h2 class="section-title">ANTECEDENTES PATOLÓGICOS</h2>
            
            <div class="form-row">
                <div class="form-group full-width">
                    <label>Antecedentes Patológicos Familiares</label>
                    <textarea rows="3"></textarea>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group full-width">
                    <label>Antecedentes Patológicos Personales</label>
                    <textarea rows="3"></textarea>
                </div>
            </div>
            
            <table class="diseases-table">
                <thead>
                    <tr>
                        <th>Anemia</th>
                        <th>Cardiopatías</th>
                        <th>Enf. Gástricas</th>
                        <th>Hepatitis</th>
                        <th>Tuberculosis</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="checkbox"></td>
                        <td><input type="checkbox"></td>
                        <td><input type="checkbox"></td>
                        <td><input type="checkbox"></td>
                        <td><input type="checkbox"></td>
                    </tr>
                </tbody>
            </table>
            
            <table class="diseases-table">
                <thead>
                    <tr>
                        <th>Asma</th>
                        <th>Diabetes Mel.</th>
                        <th>Epilepsia</th>
                        <th>Hipertensión</th>
                        <th>VIH</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="checkbox"></td>
                        <td><input type="checkbox"></td>
                        <td><input type="checkbox"></td>
                        <td><input type="checkbox"></td>
                        <td><input type="checkbox"></td>
                    </tr>
                </tbody>
            </table>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Otros:</label>
                    <input type="text">
                </div>
                <div class="form-group">
                    <label>Ninguno:</label>
                    <input type="checkbox">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Alergias:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="radio" id="alergias-si" name="alergias">
                            <label for="alergias-si">SI</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="radio" id="alergias-no" name="alergias">
                            <label for="alergias-no">NO</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Especifique:</label>
                    <input type="text">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Embarazo:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="radio" id="embarazo-si" name="embarazo">
                            <label for="embarazo-si">SI</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="radio" id="embarazo-no" name="embarazo">
                            <label for="embarazo-no">NO</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Semanas:</label>
                    <input type="text">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>¿Está en tratamiento médico?</label>
                    <input type="text">
                </div>
                <div class="form-group">
                    <label>¿Actualmente recibe algún medicamento?</label>
                    <input type="text">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>¿Tuvo hemorragia después de una extracción dental?</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="radio" id="hemorragia-si" name="hemorragia">
                            <label for="hemorragia-si">SI</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="radio" id="hemorragia-no" name="hemorragia">
                            <label for="hemorragia-no">NO</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Especifique:</label>
                    <input type="text" placeholder="Inmediata - Mediata">
                </div>
            </div>
        </div>
        
        <!-- Las demás secciones se mantienen igual... -->
        
        <!-- SECCIÓN DEL ODONTOGRAMA -->
        <div class="odontograma-section">
            <h1>SECCION 8</h1>
            <h2>ODONTOGRAMA</h2>
            
            <div class="odontograma-container">
                <div class="dental-chart" id="dentalChart">
                    <!-- Los dientes se generarán con JavaScript -->
                </div>
            </div>
            
            <div class="current-selection" id="currentSelection">
                Seleccione un diente y luego elija un área y un diagnóstico
            </div>
            
            <!-- Selector de áreas -->
            <div class="area-selector" id="areaSelector">
                <div class="area-selector-title">Seleccione un área del diente:</div>
                <div class="area-buttons">
                    <button class="area-btn" data-area="center">Centro</button>
                    <button class="area-btn" data-area="top">Superior</button>
                    <button class="area-btn" data-area="bottom">Inferior</button>
                    <button class="area-btn" data-area="left">Izquierda</button>
                    <button class="area-btn" data-area="right">Derecha</button>
                </div>
            </div>
            
            <!-- Criterios de diagnóstico -->
            <h3 style="text-align: center; margin: 15px 0 10px; font-size: 16px;">CRITERIOS DE DIAGNÓSTICO</h3>
            
            <div class="diagnostic-criteria" id="diagnosticCriteria">
                <div class="criteria-item" data-state="sano">
                    <div class="criteria-color sano-color"></div>
                    <div class="criteria-label">0 - SANO</div>
                </div>
                <div class="criteria-item" data-state="cariado">
                    <div class="criteria-color cariado-color"></div>
                    <div class="criteria-label">1 - CARIADO</div>
                </div>
                <div class="criteria-item" data-state="obturado">
                    <div class="criteria-color obturado-color"></div>
                    <div class="criteria-label">2 - OBTURADO</div>
                </div>
                <div class="criteria-item" data-state="cariado-obturado">
                    <div class="criteria-color cariado-color" style="width: 50%; display: inline-block;"></div>
                    <div class="criteria-color obturado-color" style="width: 50%; display: inline-block;"></div>
                    <div class="criteria-label">3 - CARIADO Y OBTURADO</div>
                </div>
                <div class="criteria-item" data-state="perdido-caries">
                    <div class="criteria-color perdido-caries-color"></div>
                    <div class="criteria-label">4 - PERDIDO POR CARIES</div>
                </div>
                <div class="criteria-item" data-state="perdido-otra">
                    <div class="criteria-color perdido-otra-color"></div>
                    <div class="criteria-label">5 - PERDIDO POR OTRA RAZÓN</div>
                </div>
                <div class="criteria-item" data-state="soporte">
                    <div class="criteria-color soporte-color"></div>
                    <div class="criteria-label">6 - SOPORTE DE PUENTE/CORONA</div>
                </div>
                <div class="criteria-item" data-state="no-erupcionado">
                    <div class="criteria-color no-erupcionado-color"></div>
                    <div class="criteria-label">7 - NO ERUPCIONADO</div>
                </div>
                <div class="criteria-item" data-state="traumatismo">
                    <div class="criteria-color traumatismo-color"></div>
                    <div class="criteria-label">8 - TRAUMATISMO</div>
                </div>
                <div class="criteria-item" data-state="no-registrado">
                    <div class="criteria-color no-registrado-color"></div>
                    <div class="criteria-label">9 - NO REGISTRADO</div>
                </div>
                <div class="criteria-item" data-state="extraccion">
                    <div class="criteria-color extraccion-color"></div>
                    <div class="criteria-label">10 - EXTRACCIÓN INDICADA</div>
                </div>
                <div class="criteria-item" data-state="traumatismo-fractura">
                    <div class="criteria-color traumatismo-fractura-color"></div>
                    <div class="criteria-label">T - TRAUMATISMO (FRACTURA)</div>
                </div>
            </div>
            
            <!-- Sección CPO-D -->
            <div class="cpod-section">
                <div class="cpod-item">
                    <span>C</span>
                    <input type="text" size="3" id="cValue">
                </div>
                <div class="cpod-item">
                    <span>P</span>
                    <input type="text" size="3" id="pValue">
                </div>
                <div class="cpod-item">
                    <span>O</span>
                    <input type="text" size="3" id="oValue">
                </div>
                <div class="cpod-item">
                    <span>D</span>
                    <input type="text" size="3" id="dValue">
                </div>
                <div class="cpod-item">
                    <span>CPO-D</span>
                    <input type="text" size="3" id="cpodValue" readonly>
                </div>
            </div>
            
            <div class="tooth-actions">
                <button class="btn btn-secondary" id="clearAll">Limpiar Todo</button>
                <button class="btn btn-primary" id="saveOdontograma">Guardar Odontograma</button>
            </div>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color selected-color"></div>
                    <span>Diente seleccionado</span>
                </div>
            </div>
        </div>
        
        <!-- Botón de envío final -->
        <div class="form-section">
            <div class="form-row">
                <div class="form-group" style="text-align: center; width: 100%;">
                    <button type="button" class="btn btn-primary" id="enviarFormulario" style="padding: 12px 30px; font-size: 16px;">
                        GUARDAR HISTORIA CLÍNICA
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // URL base de tu API Spring Boot - AJUSTA SEGÚN TU CONFIGURACIÓN
        const API_BASE_URL = 'http://localhost:8080';
        
        document.addEventListener('DOMContentLoaded', function() {
            // ========== FUNCIONALIDAD DE BÚSQUEDA ==========
            
            // Elementos de búsqueda
            const nombreBusqueda = document.getElementById('nombreBusqueda');
            const ciBusqueda = document.getElementById('ciBusqueda');
            const btnBuscar = document.getElementById('btnBuscar');
            const resultadosBusqueda = document.getElementById('resultadosBusqueda');
            const listaResultados = document.getElementById('listaResultados');
            
            // Elementos del formulario para llenar con datos del paciente
            const numHistoriaClinica = document.getElementById('numHistoriaClinica');
            const ciPaciente = document.getElementById('ciPaciente');
            const numExpediente = document.getElementById('numExpediente');
            const personaInformacion = document.getElementById('personaInformacion');
            const edadPaciente = document.getElementById('edadPaciente');
            
            // Elementos de datos personales
            const apellidoPaterno = document.getElementById('apellidoPaterno');
            const apellidoMaterno = document.getElementById('apellidoMaterno');
            const nombres = document.getElementById('nombres');
            const lugarNacimiento = document.getElementById('lugarNacimiento');
            const ocupacion = document.getElementById('ocupacion');
            const estadoCivil = document.getElementById('estadoCivil');
            const direccion = document.getElementById('direccion');
            const telefono = document.getElementById('telefono');
            const gradoInstruccion = document.getElementById('gradoInstruccion');
            
            // Elementos del header
            const headerExpediente = document.getElementById('headerExpediente');
            const headerHistoria = document.getElementById('headerHistoria');
            const headerCI = document.getElementById('headerCI');
            
            // Función para buscar pacientes en el backend
            async function buscarPacientes() {
                const nombre = nombreBusqueda.value.trim();
                const ci = ciBusqueda.value.trim();
                
                // Validar que al menos un campo tenga datos
                if (!nombre && !ci) {
                    alert('Por favor, ingrese al menos un nombre o un CI para buscar.');
                    return;
                }
                
                // Mostrar loading
                listaResultados.innerHTML = '<div class="loading">Buscando pacientes...</div>';
                resultadosBusqueda.style.display = 'block';
                btnBuscar.disabled = true;
                btnBuscar.textContent = 'BUSCANDO...';
                
                try {
                    let url;
                    if (nombre && ci) {
                        // Buscar por nombre y CI
                        url = `${API_BASE_URL}/recepcion/buscar/pacientes?nombre=${encodeURIComponent(nombre)}`;
                    } else if (nombre) {
                        // Buscar solo por nombre
                        url = `${API_BASE_URL}/recepcion/buscar/pacientes?nombre=${encodeURIComponent(nombre)}`;
                    } else {
                        // Buscar solo por CI
                        url = `${API_BASE_URL}/recepcion/buscar/pacientes?nombre=${encodeURIComponent(ci)}`;
                    }
                    
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        throw new Error(`Error en la búsqueda: ${response.status}`);
                    }
                    
                    const pacientes = await response.json();
                    mostrarResultados(pacientes);
                    
                } catch (error) {
                    console.error('Error al buscar pacientes:', error);
                    listaResultados.innerHTML = '<div class="no-results">Error al realizar la búsqueda. Verifique la conexión.</div>';
                } finally {
                    btnBuscar.disabled = false;
                    btnBuscar.textContent = 'BUSCAR';
                }
            }
            
            // Función para mostrar resultados de búsqueda
            function mostrarResultados(pacientes) {
                listaResultados.innerHTML = '';
                
                if (!pacientes || pacientes.length === 0) {
                    listaResultados.innerHTML = '<div class="no-results">No se encontraron pacientes con los criterios de búsqueda.</div>';
                } else {
                    pacientes.forEach(paciente => {
                        const item = document.createElement('div');
                        item.className = 'result-item';
                        
                        // Formatear nombre completo
                        const nombreCompleto = `${paciente.persona?.nombre || ''} ${paciente.persona?.apellido || ''}`.trim();
                        
                        item.innerHTML = `
                            <strong>${nombreCompleto}</strong> - CI: ${paciente.persona?.ci || 'N/A'} - Historial: ${paciente.historialClinico || 'N/A'}
                        `;
                        item.addEventListener('click', () => seleccionarPaciente(paciente));
                        listaResultados.appendChild(item);
                    });
                }
                
                resultadosBusqueda.style.display = 'block';
            }
            
            // Función para seleccionar un paciente y llenar el formulario
            function seleccionarPaciente(paciente) {
                // Llenar campos del formulario con datos del paciente
                numHistoriaClinica.value = paciente.historialClinico || '';
                ciPaciente.value = paciente.persona?.ci || '';
                numExpediente.value = paciente.id || '';
                personaInformacion.value = `${paciente.persona?.nombre || ''} ${paciente.persona?.apellido || ''}`.trim();
                edadPaciente.value = paciente.persona?.edad || '';
                
                // Llenar datos personales
                apellidoPaterno.value = paciente.persona?.apellido || '';
                apellidoMaterno.value = ''; // Ajusta según tu modelo de datos
                nombres.value = paciente.persona?.nombre || '';
                lugarNacimiento.value = paciente.lugarNacimiento || '';
                ocupacion.value = paciente.ocupacion || '';
                estadoCivil.value = paciente.estadoCivil || '';
                direccion.value = paciente.direccion || '';
                telefono.value = paciente.telefono || '';
                gradoInstruccion.value = paciente.persona?.gradoInstruccion || '';
                
                // Establecer el sexo
                if (paciente.persona?.sexo) {
                    const sexo = paciente.persona.sexo.toUpperCase();
                    if (sexo === 'M') {
                        document.getElementById('masculino').checked = true;
                    } else if (sexo === 'F') {
                        document.getElementById('femenino').checked = true;
                    }
                }
                
                // Actualizar header
                headerExpediente.textContent = paciente.id || '-';
                headerHistoria.textContent = paciente.historialClinico || '-';
                headerCI.textContent = paciente.persona?.ci || '-';
                
                // Ocultar resultados
                resultadosBusqueda.style.display = 'none';
                
                // Limpiar campos de búsqueda
                nombreBusqueda.value = '';
                ciBusqueda.value = '';
                
                // Desplazar al formulario principal
                document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
            }
            
            // Event listeners para búsqueda
            btnBuscar.addEventListener('click', buscarPacientes);
            
            // Permitir búsqueda con Enter
            nombreBusqueda.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    buscarPacientes();
                }
            });
            
            ciBusqueda.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    buscarPacientes();
                }
            });
            
            // Ocultar resultados al hacer clic fuera
            document.addEventListener('click', function(e) {
                if (!resultadosBusqueda.contains(e.target) && 
                    e.target !== nombreBusqueda && 
                    e.target !== ciBusqueda && 
                    e.target !== btnBuscar) {
                    resultadosBusqueda.style.display = 'none';
                }
            });
            
            // ========== FUNCIONALIDAD DEL ODONTOGRAMA ==========
            
            const dentalChart = document.getElementById('dentalChart');
            const diagnosticCriteria = document.getElementById('diagnosticCriteria');
            const clearAllBtn = document.getElementById('clearAll');
            const saveOdontogramaBtn = document.getElementById('saveOdontograma');
            const currentSelection = document.getElementById('currentSelection');
            const areaSelector = document.getElementById('areaSelector');
            const totalTeethInput = document.getElementById('totalTeeth');
            
            // Elementos CPO-D
            const cValue = document.getElementById('cValue');
            const pValue = document.getElementById('pValue');
            const oValue = document.getElementById('oValue');
            const dValue = document.getElementById('dValue');
            const cpodValue = document.getElementById('cpodValue');
            
            let selectedTooth = null;
            let selectedArea = null;
            let selectedState = null;
            
            // Generar todos los dientes automáticamente
            function generateTeeth() {
                // Dientes superiores (18-11, 21-28)
                const upperTeeth = [18, 17, 16, 15, 14, 13, 12, 11, 21, 22, 23, 24, 25, 26, 27, 28];
                // Dientes inferiores (48-41, 31-38)
                const lowerTeeth = [48, 47, 46, 45, 44, 43, 42, 41, 31, 32, 33, 34, 35, 36, 37, 38];
                
                // Añadir etiqueta para maxilar superior
                const upperLabel = document.createElement('div');
                upperLabel.className = 'jaw-label';
                upperLabel.textContent = 'MAXILAR SUPERIOR';
                dentalChart.appendChild(upperLabel);
                
                // Generar dientes superiores
                upperTeeth.forEach(toothNumber => {
                    createToothElement(toothNumber);
                });
                
                // Añadir etiqueta para mandíbula inferior
                const lowerLabel = document.createElement('div');
                lowerLabel.className = 'jaw-label';
                lowerLabel.textContent = 'MANDÍBULA INFERIOR';
                dentalChart.appendChild(lowerLabel);
                
                // Generar dientes inferiores
                lowerTeeth.forEach(toothNumber => {
                    createToothElement(toothNumber);
                });
            }
            
            // Crear elemento de diente individual
            function createToothElement(toothNumber) {
                const toothContainer = document.createElement('div');
                toothContainer.className = 'tooth-container';
                
                const toothNumberElement = document.createElement('div');
                toothNumberElement.className = 'tooth-number';
                toothNumberElement.textContent = toothNumber;
                
                const toothElement = document.createElement('div');
                toothElement.className = 'tooth';
                toothElement.dataset.tooth = toothNumber;
                
                const svgElement = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svgElement.setAttribute('viewBox', '0 0 100 100');
                svgElement.setAttribute('width', '100%');
                svgElement.setAttribute('height', '100%');
                
                // Contorno del diente
                const outline = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                outline.setAttribute('x', '5');
                outline.setAttribute('y', '5');
                outline.setAttribute('width', '90');
                outline.setAttribute('height', '90');
                outline.setAttribute('stroke', 'black');
                outline.setAttribute('stroke-width', '2');
                outline.setAttribute('fill', 'none');
                
                // Área central
                const center = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                center.setAttribute('class', 'center');
                center.setAttribute('x', '35');
                center.setAttribute('y', '35');
                center.setAttribute('width', '30');
                center.setAttribute('height', '30');
                center.setAttribute('stroke', 'black');
                center.setAttribute('stroke-width', '2');
                center.setAttribute('fill', 'white');
                
                // Área izquierda
                const left = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                left.setAttribute('class', 'left');
                left.setAttribute('d', 'M5,5 L35,35 L35,65 L5,95 Z');
                left.setAttribute('stroke', 'black');
                left.setAttribute('stroke-width', '1.5');
                left.setAttribute('fill', 'white');
                
                // Área derecha
                const right = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                right.setAttribute('class', 'right');
                right.setAttribute('d', 'M95,5 L65,35 L65,65 L95,95 Z');
                right.setAttribute('stroke', 'black');
                right.setAttribute('stroke-width', '1.5');
                right.setAttribute('fill', 'white');
                
                // Área superior
                const top = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                top.setAttribute('class', 'top');
                top.setAttribute('d', 'M5,5 L35,35 L65,35 L95,5 Z');
                top.setAttribute('stroke', 'black');
                top.setAttribute('stroke-width', '1.5');
                top.setAttribute('fill', 'white');
                
                // Área inferior
                const bottom = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                bottom.setAttribute('class', 'bottom');
                bottom.setAttribute('d', 'M5,95 L35,65 L65,65 L95,95 Z');
                bottom.setAttribute('stroke', 'black');
                bottom.setAttribute('stroke-width', '1.5');
                bottom.setAttribute('fill', 'white');
                
                // Añadir todos los elementos al SVG
                svgElement.appendChild(outline);
                svgElement.appendChild(center);
                svgElement.appendChild(left);
                svgElement.appendChild(right);
                svgElement.appendChild(top);
                svgElement.appendChild(bottom);
                
                toothElement.appendChild(svgElement);
                toothContainer.appendChild(toothNumberElement);
                toothContainer.appendChild(toothElement);
                dentalChart.appendChild(toothContainer);
            }
            
            // Inicializar el odontograma
            generateTeeth();
            
            // Añadir eventos a los dientes
            document.addEventListener('click', function(e) {
                if (e.target.closest('.tooth')) {
                    const tooth = e.target.closest('.tooth');
                    
                    // Quitar selección anterior
                    document.querySelectorAll('.tooth').forEach(t => {
                        t.classList.remove('selected');
                    });
                    
                    // Seleccionar nuevo diente
                    tooth.classList.add('selected');
                    selectedTooth = tooth;
                    
                    // Mostrar selector de áreas
                    areaSelector.style.display = 'flex';
                    
                    // Resetear selección de área
                    document.querySelectorAll('.area-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    selectedArea = null;
                    selectedState = null;
                    
                    currentSelection.textContent = `Diente seleccionado: ${tooth.dataset.tooth}. Seleccione un área.`;
                }
            });
            
            // Añadir eventos a las áreas del selector
            document.querySelectorAll('.area-btn').forEach(areaBtn => {
                areaBtn.addEventListener('click', function() {
                    // Quitar selección anterior
                    document.querySelectorAll('.area-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // Seleccionar nueva área
                    this.classList.add('active');
                    selectedArea = this.dataset.area;
                    
                    currentSelection.textContent = `Diente ${selectedTooth.dataset.tooth}, área: ${selectedArea}. Seleccione un diagnóstico.`;
                });
            });
            
            // Añadir eventos a los criterios de diagnóstico
            document.querySelectorAll('.criteria-item').forEach(criteria => {
                criteria.addEventListener('click', function() {
                    if (selectedTooth && selectedArea) {
                        selectedState = this.dataset.state;
                        const svg = selectedTooth.querySelector('svg');
                        
                        // Remover todas las clases de estado del área seleccionada
                        const classesToRemove = [];
                        svg.classList.forEach(className => {
                            if (className.includes(selectedArea)) {
                                classesToRemove.push(className);
                            }
                        });
                        classesToRemove.forEach(className => {
                            svg.classList.remove(className);
                        });
                        
                        // Añadir la clase del estado seleccionado para el área específica
                        svg.classList.add(`${selectedState}-${selectedArea}`);
                        
                        currentSelection.textContent = `Diente ${selectedTooth.dataset.tooth}, área ${selectedArea} marcada como: ${this.querySelector('.criteria-label').textContent}`;
                        
                        // Actualizar valores CPO-D
                        updateCPOD();
                    } else if (!selectedTooth) {
                        alert('Por favor, seleccione un diente primero');
                    } else if (!selectedArea) {
                        alert('Por favor, seleccione un área del diente primero');
                    }
                });
            });
            
            // Función para actualizar valores CPO-D
            function updateCPOD() {
                let c = 0, p = 0, o = 0, d = 0;
                
                document.querySelectorAll('.tooth').forEach(tooth => {
                    const svg = tooth.querySelector('svg');
                    
                    // Verificar si el diente tiene alguna área cariada
                    let hasCaries = false;
                    svg.classList.forEach(className => {
                        if (className.includes('cariado-')) {
                            hasCaries = true;
                        }
                    });
                    
                    if (hasCaries) {
                        c++;
                    }
                    
                    // Aquí puedes agregar lógica adicional para P, O y D según tus criterios
                });
                
                cValue.value = c;
                pValue.value = p;
                oValue.value = o;
                dValue.value = d;
                cpodValue.value = c + p + o;
            }
            
            // Limpiar todo
            clearAllBtn.addEventListener('click', function() {
                document.querySelectorAll('.tooth').forEach(tooth => {
                    tooth.classList.remove('selected');
                    const svg = tooth.querySelector('svg');
                    
                    // Remover todas las clases de diagnóstico
                    const classesToRemove = [];
                    svg.classList.forEach(className => {
                        if (className.includes('-center') || 
                            className.includes('-left') || 
                            className.includes('-right') ||
                            className.includes('-top') ||
                            className.includes('-bottom')) {
                            classesToRemove.push(className);
                        }
                    });
                    classesToRemove.forEach(className => {
                        svg.classList.remove(className);
                    });
                });
                
                document.querySelectorAll('.area-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                selectedTooth = null;
                selectedArea = null;
                selectedState = null;
                areaSelector.style.display = 'none';
                currentSelection.textContent = 'Seleccione un diente y luego elija un estado';
                
                // Limpiar CPO-D
                cValue.value = '';
                pValue.value = '';
                oValue.value = '';
                dValue.value = '';
                cpodValue.value = '';
            });
            
            // Guardar odontograma
            saveOdontogramaBtn.addEventListener('click', function() {
                const teethData = {};
                document.querySelectorAll('.tooth').forEach(tooth => {
                    const toothNumber = tooth.dataset.tooth;
                    const svg = tooth.querySelector('svg');
                    
                    const areasData = {
                        center: getDiagnosisForArea(svg, 'center'),
                        left: getDiagnosisForArea(svg, 'left'),
                        right: getDiagnosisForArea(svg, 'right'),
                        top: getDiagnosisForArea(svg, 'top'),
                        bottom: getDiagnosisForArea(svg, 'bottom')
                    };
                    
                    teethData[toothNumber] = areasData;
                });
                
                alert('Odontograma guardado correctamente');
                console.log('Datos del odontograma:', teethData);
            });
            
            // Función auxiliar para obtener el diagnóstico de un área específica
            function getDiagnosisForArea(svg, area) {
                let diagnosis = null;
                svg.classList.forEach(className => {
                    if (className.endsWith(`-${area}`)) {
                        diagnosis = className.split('-')[0];
                    }
                });
                return diagnosis;
            }
            
            // Event listener para el botón de guardar historia clínica
            document.getElementById('enviarFormulario').addEventListener('click', function() {
                alert('Historia clínica guardada exitosamente');
                // Aquí puedes implementar la lógica para enviar todos los datos al backend
            });
        });
    </script>
</body>
</html>